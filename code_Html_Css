<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Trinity AI Assistant - Chatbot Professionnel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            --secondary-gradient: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --message-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow-primary: 0 20px 60px rgba(0, 0, 0, 0.3);
            --shadow-message: 0 2px 5px rgba(0, 0, 0, 0.05);
            --border-radius: 20px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: var(--primary-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
        }

        .chat-container {
            width: 100%;
            max-width: 950px;
            height: 90vh;
            max-height: 800px;
            background: #ffffff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-primary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-header {
            background: var(--secondary-gradient);
            color: #ffffff;
            padding: 28px 35px;
            border-bottom: 3px solid #1a252f;
            position: relative;
            z-index: 10;
        }

        .chat-header h1 {
            font-size: 26px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .chat-header p {
            font-size: 14px;
            color: #b0bec5;
            font-weight: 400;
            line-height: 1.4;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #4caf50;
            border-radius: 50%;
            margin-right: 10px;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.6;
                transform: scale(0.95);
            }
        }

        .api-key-section {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            padding: 20px 25px;
            margin: 25px 35px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .api-key-section h3 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .api-input-group {
            display: flex;
            gap: 12px;
            align-items: stretch;
        }

        .api-input-group input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 14px;
            font-family: monospace;
            transition: all 0.3s;
        }

        .api-input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .api-input-group button {
            padding: 12px 28px;
            background: var(--secondary-gradient);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .api-input-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 35px;
            background: linear-gradient(180deg, #f8f9fa 0%, #f5f7fa 100%);
            position: relative;
        }

        .welcome-screen {
            text-align: center;
            padding: 60px 30px;
            color: #7f8c8d;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .welcome-screen h2 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 15px;
        }

        .welcome-screen p {
            font-size: 15px;
            margin-bottom: 10px;
        }

        .welcome-screen .features {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: left;
        }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .feature-card h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .feature-card p {
            color: #7f8c8d;
            font-size: 13px;
        }

        .message {
            margin-bottom: 24px;
            display: flex;
            animation: messageSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            animation-fill-mode: forwards;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 75%;
            padding: 16px 22px;
            border-radius: 18px;
            line-height: 1.7;
            font-size: 15px;
            word-wrap: break-word;
            position: relative;
        }

        .message.user .message-bubble {
            background: var(--message-gradient);
            color: #ffffff;
            border-bottom-right-radius: 6px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .message.assistant .message-bubble {
            background: #ffffff;
            color: #2c3e50;
            border: 1px solid #e0e6ed;
            border-bottom-left-radius: 6px;
            box-shadow: var(--shadow-message);
        }

        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 6px;
            text-align: right;
        }

        .message.assistant .message-time {
            color: #95a5a6;
        }

        .typing-indicator {
            display: none;
            padding: 18px 24px;
            background: #ffffff;
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            max-width: 80px;
            border: 1px solid #e0e6ed;
            box-shadow: var(--shadow-message);
        }

        .typing-indicator.active {
            display: flex;
            gap: 6px;
            align-items: center;
            justify-content: center;
        }

        .typing-dot {
            width: 10px;
            height: 10px;
            background: #95a5a6;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-12px);
            }
        }

        .chat-input-area {
            background: #ffffff;
            padding: 25px 35px;
            border-top: 2px solid #e0e6ed;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
        }

        .input-wrapper {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        #userMessage {
            flex: 1;
            padding: 16px 22px;
            border: 2px solid #e0e6ed;
            border-radius: 28px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
            background: #f8f9fa;
            font-family: inherit;
            resize: none;
        }

        #userMessage:focus {
            border-color: #667eea;
            background: #ffffff;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        #sendBtn {
            padding: 16px 32px;
            background: var(--message-gradient);
            color: #ffffff;
            border: none;
            border-radius: 28px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            white-space: nowrap;
        }

        #sendBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        #sendBtn:active:not(:disabled) {
            transform: translateY(0);
        }

        #sendBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .chat-messages::-webkit-scrollbar {
            width: 10px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f3f5;
            border-radius: 5px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #95a5a6;
            border-radius: 5px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #7f8c8d;
        }

        .error-message {
            background: #ffe6e6;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            color: #c0392b;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
            }

            .chat-header {
                padding: 20px 25px;
            }

            .chat-header h1 {
                font-size: 22px;
            }

            .chat-messages {
                padding: 25px 20px;
            }

            .message-bubble {
                max-width: 85%;
            }

            .welcome-screen .features {
                grid-template-columns: 1fr;
            }

            .chat-input-area {
                padding: 20px;
            }

            #sendBtn {
                padding: 16px 24px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>
                <span class="status-indicator"></span>
                Trinity AI Assistant
            </h1>
            <p>Modèle avancé 400B paramètres - Architecture Sparse MoE (13B actifs) - Spécialisé en conversation naturelle</p>
        </div>

        <div class="api-key-section" id="apiSection">
            <h3>Configuration de la clé API</h3>
            <div class="api-input-group">
                <input 
                    type="password" 
                    id="apiKeyInput" 
                    placeholder="Entrez votre clé API Arcee AI (sk-...)"
                    autocomplete="off"
                >
                <button onclick="configureAPI()">Activer</button>
            </div>
        </div>

        <div class="chat-messages" id="messagesArea">
            <div class="welcome-screen">
                <h2>Bienvenue sur Trinity AI Assistant</h2>
                <p>Votre assistant conversationnel intelligent propulsé par Trinity-Large-Preview</p>
                <p style="font-size: 13px; margin-top: 20px;">Configurez votre clé API pour commencer</p>
                
                <div class="features">
                    <div class="feature-card">
                        <h4>Conversation Naturelle</h4>
                        <p>Échanges fluides et contextuels grâce à 400B paramètres</p>
                    </div>
                    <div class="feature-card">
                        <h4>Rédaction Créative</h4>
                        <p>Génération de contenu original et storytelling avancé</p>
                    </div>
                    <div class="feature-card">
                        <h4>Assistance Technique</h4>
                        <p>Support pour le code et navigation dans des outils complexes</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-area">
            <div class="input-wrapper">
                <input 
                    type="text" 
                    id="userMessage" 
                    placeholder="Tapez votre message ici..."
                    disabled
                    onkeypress="handleKeyPress(event)"
                    autocomplete="off"
                >
                <button id="sendBtn" onclick="sendMessage()" disabled>Envoyer</button>
            </div>
        </div>
    </div>

    <script>
        let apiKey = '';
        let conversationHistory = [];
        let messageCount = 0;

        function configureAPI() {
            const input = document.getElementById('apiKeyInput');
            const key = input.value.trim();
            
            if (!key) {
                alert('Veuillez entrer une clé API valide');
                return;
            }
            
            if (!key.startsWith('sk-')) {
                alert('La clé API doit commencer par "sk-"');
                return;
            }
            
            apiKey = key;
            document.getElementById('apiSection').style.display = 'none';
            document.getElementById('userMessage').disabled = false;
            document.getElementById('sendBtn').disabled = false;
            
            initializeChat();
        }

        function initializeChat() {
            const messagesArea = document.getElementById('messagesArea');
            messagesArea.innerHTML = '';
            conversationHistory = [];
            
            addMessage('assistant', 'Bonjour ! Je suis Trinity AI Assistant, un modèle de langage avancé de 400 milliards de paramètres. Je suis ici pour vous aider avec vos questions, de la rédaction créative, du développement logiciel, ou toute autre tâche. Comment puis-je vous assister aujourd\'hui ?');
            
            document.getElementById('userMessage').focus();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function addMessage(role, content) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.style.animationDelay = `${messageCount * 0.05}s`;
            messageCount++;
            
            const timestamp = new Date().toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const formattedContent = content.replace(/\n/g, '<br>');
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    ${formattedContent}
                    <div class="message-time">${timestamp}</div>
                </div>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function showTyping() {
            const messagesArea = document.getElementById('messagesArea');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="typing-indicator active">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesArea.appendChild(typingDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function hideTyping() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('userMessage');
            const message = input.value.trim();
            
            if (!message) return;
            
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            input.disabled = true;
            
            addMessage('user', message);
            input.value = '';
            
            conversationHistory.push({
                role: 'user',
                content: message
            });
            
            showTyping();
            
            try {
                const response = await fetch('https://api.arcee.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'arcee-ai/trinity-large-preview',
                        messages: conversationHistory,
                        max_tokens: 2048,
                        temperature: 0.7,
                        top_p: 0.9,
                        stream: false
                    })
                });

                hideTyping();

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error?.message || `Erreur HTTP ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('Réponse invalide de l\'API');
                }
                
                const assistantMessage = data.choices[0].message.content;
                
                conversationHistory.push({
                    role: 'assistant',
                    content: assistantMessage
                });
                
                addMessage('assistant', assistantMessage);
                
            } catch (error) {
                hideTyping();
                console.error('Erreur complète:', error);
                
                let errorMessage = 'Une erreur est survenue. ';
                
                if (error.message.includes('401') || error.message.includes('Unauthorized')) {
                    errorMessage += 'Clé API invalide ou expirée. Veuillez vérifier votre clé API.';
                } else if (error.message.includes('429')) {
                    errorMessage += 'Trop de requêtes. Veuillez attendre quelques instants.';
                } else if (error.message.includes('500') || error.message.includes('503')) {
                    errorMessage += 'Le service est temporairement indisponible. Réessayez dans quelques instants.';
                } else {
                    errorMessage += error.message;
                }
                
                addMessage('assistant', `⚠️ ${errorMessage}`);
            } finally {
                sendBtn.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        // Auto-focus sur le champ de saisie au chargement
        window.addEventListener('load', () => {
            document.getElementById('apiKeyInput').focus();
        });
    </script>
</body>
</html>
